{% extends "base.html" %}

{% block title %}テーブルメンテナンス - DBメンテ{% endblock %}

{% block head %}
<style>
  .page-title { font-size: 18px; font-weight: bold; margin: 0 0 16px 0; padding-bottom: 8px; border-bottom: 2px solid #333; }
  .table-selector { margin-bottom: 16px; }
  .table-selector label { font-weight: bold; margin-right: 8px; }
  .table-selector select { padding: 4px 8px; font-size: 14px; }
  .table-selector button { padding: 4px 12px; margin-left: 8px; }
  .section-title { font-weight: bold; margin: 16px 0 8px 0; font-size: 14px; }
  .data-table { width: 100%; border-collapse: collapse; margin-bottom: 16px; }
  .data-table th, .data-table td { border: 1px solid #ccc; padding: 6px 8px; text-align: left; font-size: 13px; }
  .data-table th { background: #e8eefa; white-space: nowrap; }
  .data-table tr:hover { background: #f5f5f5; }
  .data-table td { max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .column-info { font-size: 12px; color: #666; }
  .no-data { color: #666; font-style: italic; padding: 16px 0; }
  .nav-links { margin-top: 16px; }
  .nav-links a { color: #0066cc; text-decoration: none; margin-right: 16px; }
  .nav-links a:hover { text-decoration: underline; }
  .row-count { font-size: 13px; color: #666; margin-bottom: 8px; }
</style>
{% endblock %}

{% block content %}
<div class="page-title">テーブルメンテナンス</div>

<div class="table-selector">
  <form method="get" action="/table/maintenance">
    <label>テーブル選択:</label>
    <select name="table_name" onchange="this.form.submit()">
      <option value="">-- 選択してください --</option>
      {% for table in tables %}
      <option value="{{ table.table_name }}" {% if table.table_name == selected_table %}selected{% endif %}>{{ table.table_name }}</option>
      {% endfor %}
    </select>
  </form>
</div>

{% if selected_table %}
<div class="section-title">カラム情報: {{ selected_table }}</div>
{% if columns %}
<table class="data-table">
  <thead>
    <tr>
      <th>カラム名</th>
      <th>データ型</th>
      <th>長さ</th>
      <th>NULL許可</th>
    </tr>
  </thead>
  <tbody>
    {% for col in columns %}
    <tr>
      <td>{{ col.column_name }}</td>
      <td>{{ col.data_type }}</td>
      <td>{{ col.data_length }}</td>
      <td>{{ col.nullable }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p class="no-data">カラム情報を取得できませんでした。</p>
{% endif %}

<div class="section-title">データ (最大100件)</div>
{% if rows %}
<p class="row-count">{{ rows|length }}件表示</p>
<div style="overflow-x: auto;">
<table class="data-table">
  <thead>
    <tr>
      {% for col_name in column_names %}
      <th>{{ col_name }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for row in rows %}
    <tr>
      {% for cell in row %}
      <td title="{{ cell }}">{{ cell }}</td>
      {% endfor %}
    </tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% else %}
<p class="no-data">データがありません。</p>
{% endif %}
{% else %}
<p class="no-data">テーブルを選択してください。</p>
{% endif %}

<div class="nav-links">
  <a href="/table/list">テーブル一覧へ</a>
  <a href="/menu">メニューへ戻る</a>
</div>
{% endblock %}
