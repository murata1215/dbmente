{% extends "base.html" %}

{% block title %}テーブルメンテナンス - DBメンテ{% endblock %}

{% block head %}
<style>
  .page-title { font-size: 18px; font-weight: bold; margin: 0 0 16px 0; padding-bottom: 8px; border-bottom: 2px solid #333; }
  .search-form { background: #f5f5f5; padding: 12px; margin-bottom: 16px; border: 1px solid #ddd; }
  .search-form label { font-weight: bold; margin-right: 8px; }
  .search-form input { padding: 4px 8px; width: 200px; }
  .search-form button { padding: 6px 16px; margin-left: 8px; }
  .table-header { background: #e8eefa; padding: 12px; margin-bottom: 16px; border: 1px solid #ccc; }
  .table-header-row { margin-bottom: 4px; }
  .table-header-label { font-weight: bold; display: inline-block; width: 120px; }
  .section-title { font-weight: bold; margin: 16px 0 8px 0; font-size: 14px; }
  .data-table { width: 100%; border-collapse: collapse; margin-bottom: 16px; }
  .data-table th, .data-table td { border: 1px solid #ccc; padding: 6px 8px; text-align: left; font-size: 13px; }
  .data-table th { background: #e8eefa; white-space: nowrap; }
  .data-table tr:hover { background: #f5f5f5; }
  .no-data { color: #666; font-style: italic; padding: 16px 0; }
  .nav-links { margin-top: 16px; }
  .nav-links a { color: #0066cc; text-decoration: none; margin-right: 16px; }
  .nav-links a:hover { text-decoration: underline; }
  .result-count { font-size: 13px; color: #666; margin-bottom: 8px; }
  .pk-mark { color: #c00; font-weight: bold; }
  .required-mark { color: #c00; }
</style>
{% endblock %}

{% block content %}
<div class="page-title">テーブルメンテナンス (Z102)</div>

<div class="search-form">
  <form method="get" action="/table/maintenance">
    <label>テーブルID:</label>
    <input type="text" name="tblnm" value="{{ tblnm }}" placeholder="例: ZM_TBL">
    <button type="submit">表示</button>
  </form>
</div>

{% if tblnm %}
  {% if table_def %}
  <div class="table-header">
    <div class="table-header-row">
      <span class="table-header-label">テーブルID:</span>
      <span>{{ table_def.tblnm }}</span>
    </div>
    <div class="table-header-row">
      <span class="table-header-label">テーブル名称:</span>
      <span>{{ table_def.tbljnm }}</span>
    </div>
    <div class="table-header-row">
      <span class="table-header-label">システム区分:</span>
      <span>{{ table_def.sys }}</span>
      <span class="table-header-label" style="margin-left: 24px;">種別:</span>
      <span>{{ table_def.shu }}</span>
    </div>
  </div>

  <div class="section-title">項目定義一覧</div>
  {% if columns %}
  <p class="result-count">{{ columns|length }}件</p>
  <div style="overflow-x: auto;">
  <table class="data-table">
    <thead>
      <tr>
        <th>NO</th>
        <th>項目ID</th>
        <th>項目名</th>
        <th>型</th>
        <th>長さ1</th>
        <th>長さ2</th>
        <th>必須</th>
        <th>PK</th>
        <th>デフォルト</th>
        <th>備考</th>
      </tr>
    </thead>
    <tbody>
      {% for col in columns %}
      <tr>
        <td>{{ col.tblno }}</td>
        <td>{{ col.bnm }}</td>
        <td>{{ col.rnm }}</td>
        <td>{{ get_kata_display(col.kata) }}</td>
        <td>{{ col.lng1 }}</td>
        <td>{{ col.lng2 or '' }}</td>
        <td>{% if col.hsu == '1' %}<span class="required-mark">*</span>{% endif %}</td>
        <td>{% if col.tkey01 == 'U' %}<span class="pk-mark">PK</span>{% endif %}</td>
        <td>{{ col.dflt or '' }}</td>
        <td>{{ col.biko or '' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  </div>
  {% else %}
  <p class="no-data">項目定義がありません。</p>
  {% endif %}
  {% else %}
  <p class="no-data">指定されたテーブルID「{{ tblnm }}」は存在しません。</p>
  {% endif %}
{% else %}
<p class="no-data">テーブルIDを入力してください。</p>
{% endif %}

<div class="nav-links">
  <a href="/table/list">テーブル一覧へ</a>
  <a href="/menu">メニューへ戻る</a>
</div>
{% endblock %}
